# ๐ ุฏููู ุงูุฃูุงู ูุงูุญูุงูุฉ

ูุนูููุงุช ุดุงููุฉ ุนู ุขููุงุช ุงูุญูุงูุฉ ูุงูุฃูุงู ูู WooCommerce Products API Manager

---

## ๐ ุงููุญุชููุงุช

1. [ูุธุฑุฉ ุนุงูุฉ](#ูุธุฑุฉ-ุนุงูุฉ)
2. [ุขููุงุช ุงูุญูุงูุฉ](#ุขููุงุช-ุงูุญูุงูุฉ)
3. [ุงูุชูุซูู ูุงูุชูููุถ](#ุงูุชูุซูู-ูุงูุชูููุถ)
4. [ุฃูุถู ุงูููุงุฑุณุงุช](#ุฃูุถู-ุงูููุงุฑุณุงุช)
5. [ูุนุงููุฑ ุงูุฃูุงู](#ูุนุงููุฑ-ุงูุฃูุงู)
6. [ุงูุชุฏููู ูุงููุฑุงูุจุฉ](#ุงูุชุฏููู-ูุงููุฑุงูุจุฉ)

---

## ๐ก๏ธ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุตููู API ูุน ุงูุชุฑููุฒ ุงูุฃุณุงุณู ุนูู ุงูุฃูุงู ูุงูุญูุงูุฉ. ุฌููุน ุงูุฑูุงุจุท ูุญููุฉ ููุดูุฑุฉ.

### ูุณุชููุงุช ุงูุญูุงูุฉ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  1๏ธโฃ HTTPS Encryption                    โ
โ     โโ ุชุดููุฑ ุฌููุน ุงูุจูุงูุงุช ุงููููููุฉ    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  2๏ธโฃ Authentication                      โ
โ     โโ ุงูุชุญูู ูู ููุงุชูุญ API            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  3๏ธโฃ Authorization                       โ
โ     โโ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  4๏ธโฃ Input Validation                    โ
โ     โโ ุชูุธูู ููุญุต ุฌููุน ุงููุฏุฎูุงุช        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  5๏ธโฃ Output Sanitization                 โ
โ     โโ ุชูุธูู ุฌููุน ุงููุฎุฑุฌุงุช             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุขููุงุช ุงูุญูุงูุฉ

### 1. ุงูุชุดููุฑ (Encryption)

#### HTTPS ููุท

**ูุทููุจ:** ุฌููุน ุทูุจุงุช API ูุฌุจ ุฃู ุชููู ุนุจุฑ HTTPS

```bash
โ https://dev.murjan.sa/wp-json/murjan-api/v1/...
โ http://dev.murjan.sa/wp-json/murjan-api/v1/...
```

**ุงูุณุจุจ:**
- ุญูุงูุฉ ุงูููุงุชูุญ ูู ุงูุงุนุชุฑุงุถ
- ุชุดููุฑ ุงูุจูุงูุงุช ุงููููููุฉ
- ููุน ูุฌูุงุช Man-in-the-Middle

**ุงูุชูููุฐ:**
```php
// ูุชู ุงูุชุญูู ุชููุงุฆูุงู ูู WordPress
if (!is_ssl() && !is_local_environment()) {
    return new WP_Error('ssl_required', 'HTTPS is required');
}
```

---

### 2. ุงูุชูุซูู (Authentication)

#### WooCommerce API Keys

**ุงูุทุฑููุฉ ุงููุณุชุฎุฏูุฉ:** Basic Authentication

```
Authorization: Basic base64(consumer_key:consumer_secret)
```

**ุงูุชุญูู ูุชุนุฏุฏ ุงููุฑุงุญู:**

```php
// ุงููุฑุญูุฉ 1: ุงูุชุญูู ูู ูุฌูุฏ ุงูููุงุชูุญ
if (!$consumer_key || !$consumer_secret) {
    return WP_Error('auth_missing');
}

// ุงููุฑุญูุฉ 2: ุงูุจุญุซ ุนู ุงูููุชุงุญ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
$key_data = get_api_key($consumer_key);
if (!$key_data) {
    return WP_Error('invalid_key');
}

// ุงููุฑุญูุฉ 3: ุงูุชุญูู ูู Consumer Secret
if (!hash_equals($key_data->consumer_secret, $consumer_secret)) {
    return WP_Error('invalid_secret');
}
```

**ุญูุงูุฉ hash_equals:**
- ูููุน Timing Attacks
- ููุงุฑูุฉ ุขููุฉ ูููุตูุต

---

### 3. ุงูุชูููุถ (Authorization)

#### ุงูุชุญูู ูู ุงูุตูุงุญูุงุช

```php
// ุตูุงุญูุงุช API Key
if ($key_data->permissions !== 'read_write') {
    return WP_Error('insufficient_permissions');
}

// ุตูุงุญูุงุช ุงููุณุชุฎุฏู
$user = get_user_by('id', $key_data->user_id);
if (!$user->has_cap('manage_woocommerce')) {
    return WP_Error('user_insufficient_permissions');
}
```

**ุงูุตูุงุญูุงุช ุงููุทููุจุฉ:**
- โ API Key: Read/Write
- โ User: manage_woocommerce capability

---

### 4. ุชูุธูู ุงููุฏุฎูุงุช (Input Sanitization)

#### ุฌููุน ุงููุฏุฎูุงุช ูุชู ุชูุธูููุง

```php
// ุงููุตูุต
$name = sanitize_text_field($input['name']);

// HTML
$description = wp_kses_post($input['description']);

// ุงูุฃุฑูุงู
$price = floatval($input['price']);
$quantity = absint($input['quantity']);

// SKU
$sku = sanitize_text_field($input['sku']);
```

**ุงููุธุงุฆู ุงููุณุชุฎุฏูุฉ:**
- `sanitize_text_field()` - ุชูุธูู ุงููุตูุต
- `wp_kses_post()` - ุชูุธูู HTML
- `floatval()` - ุชุญููู ุฅูู ุฑูู ุนุดุฑู
- `absint()` - ุฑูู ุตุญูุญ ููุฌุจ

---

### 5. ุญูุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### Prepared Statements

**ุฌููุน ุงุณุชุนูุงูุงุช SQL ุชุณุชุฎุฏู Prepared Statements:**

```php
$wpdb->prepare(
    "SELECT * FROM {$wpdb->prefix}woocommerce_api_keys 
     WHERE consumer_key = %s",
    $consumer_key
);
```

**ุงูููุงุฆุฏ:**
- โ ุญูุงูุฉ ูู SQL Injection
- โ ูุนุงูุฌุฉ ุขููุฉ ููุจูุงูุงุช
- โ ุชุดููุฑ ุงููุนุงููุงุช

---

### 6. ุญูุงูุฉ ูู XSS

#### ุชูุธูู ุงููุฎุฑุฌุงุช

```php
// ุนุฑุถ ุงูุจูุงูุงุช
echo esc_html($product->get_name());
echo esc_url($product->get_permalink());
echo esc_attr($product->get_sku());

// ูู JSON
wp_send_json(array(
    'name' => sanitize_text_field($name)
));
```

---

## ๐ ุงูุชูุซูู ูุงูุชูููุถ

### ุฅูุดุงุก ููุงุชูุญ API ุขููุฉ

#### โ ุงูุทุฑููุฉ ุงูุตุญูุญุฉ:

```
1. WooCommerce > Settings > Advanced > REST API
2. Add key
3. Description: ูุงุถุญุฉ ููุญุฏุฏุฉ (ูุซู: "Mobile App v1.0")
4. User: ุญุณุงุจ ูุฎุตุต ููู API (ููุณ admin ุงูุฑุฆูุณู)
5. Permissions: Read/Write ููุท ูุง ุชุญุชุงุฌู
```

#### โ ุฃุฎุทุงุก ุดุงุฆุนุฉ:

```
โ ุงุณุชุฎุฏุงู ุญุณุงุจ admin ุงูุฑุฆูุณู
โ ุตูุงุญูุงุช ุบูุฑ ูุญุฏุฏุฉ
โ ูุตู ุบูุฑ ูุงุถุญ
โ ุนุฏู ุชุฏููุฑ ุงูููุงุชูุญ ุจุดูู ุฏูุฑู
```

---

### ุชุฎุฒูู ุงูููุงุชูุญ

#### โ ุงูุทุฑููุฉ ุงูุขููุฉ:

```javascript
// ูู Node.js - ุงุณุชุฎุฏู ูุชุบูุฑุงุช ุงูุจูุฆุฉ
require('dotenv').config();

const API_KEY = process.env.WOO_CONSUMER_KEY;
const API_SECRET = process.env.WOO_CONSUMER_SECRET;
```

```php
// ูู PHP - ุงุณุชุฎุฏู ููู config ุฎุงุฑุฌ public_html
define('WOO_CONSUMER_KEY', getenv('WOO_CONSUMER_KEY'));
define('WOO_CONSUMER_SECRET', getenv('WOO_CONSUMER_SECRET'));
```

```python
# ูู Python - ุงุณุชุฎุฏู ูุชุบูุฑุงุช ุงูุจูุฆุฉ
import os
API_KEY = os.getenv('WOO_CONSUMER_KEY')
API_SECRET = os.getenv('WOO_CONSUMER_SECRET')
```

#### โ ูุง ุชูุนู ุฃุจุฏุงู:

```javascript
// โ ูุง ุชุญูุธ ุงูููุงุชูุญ ูู ุงูููุฏ ูุจุงุดุฑุฉ
const API_KEY = 'ck_123456789...';

// โ ูุง ุชุฑูุนูุง ุนูู GitHub
git add config.js

// โ ูุง ุชุถุนูุง ูู JavaScript ูููุชุตูุญ
<script>
    const apiKey = 'ck_123456789...';
</script>
```

---

## ๐ก๏ธ ุฃูุถู ุงูููุงุฑุณุงุช

### 1. ุงุณุชุฎุฏุงู HTTPS ุฏุงุฆูุงู

```bash
# ุชุซุจูุช SSL Certificate
sudo certbot --nginx -d dev.murjan.sa
```

### 2. ุชุฏููุฑ ุงูููุงุชูุญ ุจุงูุชุธุงู

**ุงูุฌุฏูู ุงูููุตู ุจู:**
- ๐ ูู 3 ุฃุดูุฑ: ููุงุณุชุฎุฏุงู ุงูุนุงุฏู
- ๐ ูู ุดูุฑ: ููุชุทุจููุงุช ุงูุญุณุงุณุฉ
- ๐ ููุฑุงู: ูู ุญุงูุฉ ุงูุงุดุชุจุงู ุจุงูุงุฎุชุฑุงู

**ุงูุทุฑููุฉ:**
```
1. ุฃูุดุฆ ููุงุชูุญ ุฌุฏูุฏุฉ
2. ุญุฏูุซ ุงูุชุทุจููุงุช ูุงุณุชุฎุฏุงู ุงูููุงุชูุญ ุงูุฌุฏูุฏุฉ
3. ุงุฎุชุจุฑ ุฌููุน ุงููุธุงุฆู
4. ุงุญุฐู ุงูููุงุชูุญ ุงููุฏููุฉ
```

### 3. ุงุณุชุฎุฏุงู ุญุณุงุจุงุช ูููุตูุฉ

```
๐ค admin - ููุฅุฏุงุฑุฉ ุงูููููุฉ
๐ค api_user_mobile - ูุชุทุจูู ุงูููุจุงูู
๐ค api_user_erp - ููุธุงู ERP
๐ค api_user_website - ูููููุน ุงูุฎุงุฑุฌู
```

**ุงูููุงุฆุฏ:**
- โ ุณูููุฉ ุงูุชุชุจุน
- โ ุฅูุบุงุก ูุตูู ูุญุฏุฏ
- โ ุชุฏููู ุฃูุถู

### 4. ุชูููุฏ ุงูุตูุงุญูุงุช

```
โ Read only - ููุนุฑุถ ููุท
โ Read/Write - ููุฅุถุงูุฉ ูุงูุชุนุฏูู
โ ูุง ุชุณุชุฎุฏู Write ููุท
```

### 5. ูุฑุงูุจุฉ ุงูุงุณุชุฎุฏุงู

```php
// ุชุณุฌูู ูุญุงููุงุช ุงููุตูู
add_action('woocommerce_api_authentication_error', function($error) {
    error_log('API Auth Failed: ' . $error->get_error_message());
});

// ุชุณุฌูู ุงูุทูุจุงุช ุงููุงุฌุญุฉ
add_action('rest_api_init', function() {
    error_log('API Request: ' . $_SERVER['REQUEST_URI']);
});
```

---

## ๐ ูุนุงููุฑ ุงูุฃูุงู

### OWASP Top 10 Compliance

#### โ 1. Injection
- ุงุณุชุฎุฏุงู Prepared Statements
- ุชูุธูู ุฌููุน ุงููุฏุฎูุงุช

#### โ 2. Broken Authentication
- WooCommerce API Keys ูููุฉ
- hash_equals ููููุงุฑูุงุช

#### โ 3. Sensitive Data Exposure
- HTTPS ุฅูุฒุงูู
- ุนุฏู ุนุฑุถ ุงูููุงุชูุญ ูู ุงูุฃุฎุทุงุก

#### โ 4. XML External Entities (XXE)
- ุนุฏู ุงุณุชุฎุฏุงู XML
- JSON ููุท

#### โ 5. Broken Access Control
- ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู
- ุงูุชุญูู ูู ุตูุงุญูุงุช API Key

#### โ 6. Security Misconfiguration
- ุฅุนุฏุงุฏุงุช ุงูุชุฑุงุถูุฉ ุขููุฉ
- ุนุฏู ุนุฑุถ ูุนูููุงุช ุงููุธุงู

#### โ 7. Cross-Site Scripting (XSS)
- ุชูุธูู ุฌููุน ุงููุฎุฑุฌุงุช
- wp_kses_post ููู HTML

#### โ 8. Insecure Deserialization
- ุนุฏู ุงุณุชุฎุฏุงู unserialize
- JSON parsing ุขูู

#### โ 9. Using Components with Known Vulnerabilities
- ุชุญุฏูุซุงุช ููุชุธูุฉ
- ุงุณุชุฎุฏุงู WordPress ู WooCommerce functions

#### โ 10. Insufficient Logging & Monitoring
- ุชุณุฌูู ูุญุงููุงุช ุงููุตูู
- ุชูุจููุงุช ูููุดุงุทุงุช ุงููุดุจููุฉ

---

## ๐ ุงูุชุฏููู ูุงููุฑุงูุจุฉ

### ุชูุนูู Logging

```php
// ูู wp-config.php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
define('WP_DEBUG_DISPLAY', false);
```

### ูุฑุงูุจุฉ ุงููุดุงุทุงุช

```php
// ุชุณุฌูู API Requests
add_filter('rest_pre_dispatch', function($result, $server, $request) {
    $route = $request->get_route();
    $method = $request->get_method();
    
    error_log("API: $method $route");
    
    return $result;
}, 10, 3);
```

### ุชูุจููุงุช ุงูุฃูุงู

```php
// ุชูุจูู ุนูุฏ ูุดู ุงูุชูุซูู ุงููุชูุฑุฑ
$failed_attempts = get_transient('api_failed_attempts_' . $ip);
if ($failed_attempts > 5) {
    // ุฅุฑุณุงู ุจุฑูุฏ ุฅููุชุฑููู ูููุฏูุฑ
    wp_mail(
        get_option('admin_email'),
        'API Security Alert',
        "Multiple failed authentication attempts from $ip"
    );
}
```

---

## ๐จ ุงูุงุณุชุฌุงุจุฉ ููุญูุงุฏุซ

### ูู ุญุงูุฉ ุงุดุชุจุงู ุจุงุฎุชุฑุงู:

#### ุงูุฎุทูุฉ 1: ุฅููุงู ุงููุตูู ููุฑุงู
```
WooCommerce > Settings > Advanced > REST API
> ุงุญุฐู ุฌููุน ุงูููุงุชูุญ ุงููุดุจููุฉ
```

#### ุงูุฎุทูุฉ 2: ูุฑุงุฌุนุฉ ุงูุณุฌูุงุช
```bash
# ุฑุงุฌุน error_log
tail -f wp-content/debug.log

# ุงุจุญุซ ุนู ูุดุงุทุงุช ูุดุจููุฉ
grep "API" wp-content/debug.log
```

#### ุงูุฎุทูุฉ 3: ุชุบููุฑ ุฌููุน ุงูููุงุชูุญ
```
1. ุฃูุดุฆ ููุงุชูุญ ุฌุฏูุฏุฉ
2. ุญุฏูุซ ุฌููุน ุงูุชุทุจููุงุช
3. ุงุญุฐู ุงูููุงุชูุญ ุงููุฏููุฉ
```

#### ุงูุฎุทูุฉ 4: ูุญุต ุงูููุชุฌุงุช
```sql
-- ุชุญูู ูู ุงูููุชุฌุงุช ุงููุถุงูุฉ ูุคุฎุฑุงู
SELECT * FROM wp_posts 
WHERE post_type = 'product' 
AND post_date > DATE_SUB(NOW(), INTERVAL 24 HOUR)
ORDER BY post_date DESC;
```

#### ุงูุฎุทูุฉ 5: ุงูุชูุซูู ูุงูุฅุจูุงุบ
```
1. ุณุฌูู ุชูุงุตูู ุงูุญุงุฏุซ
2. ุฃุจูุบ ุงููุฑูู
3. ุฑุงุฌุน ูุญุณูู ุงูุฅุฌุฑุงุกุงุช
```

---

## ๐ ูุงุฆูุฉ ุงููุฑุงุฌุนุฉ ุงูุฃูููุฉ

### ูุจู ุงูุฅุทูุงู:

- [ ] HTTPS ููุนูู ููุนูู
- [ ] SSL Certificate ุตุงูุญ
- [ ] ููุงุชูุญ API ูููุฉ
- [ ] ุตูุงุญูุงุช ูุญุฏุฏุฉ ุจุฏูุฉ
- [ ] ุญุณุงุจุงุช ูููุตูุฉ ููู API
- [ ] Logging ููุนูู
- [ ] Debug mode ูุทูุฃ ูู ุงูุฅูุชุงุฌ
- [ ] Firewall ููุนูู
- [ ] ูุณุฎ ุงุญุชูุงุทูุฉ ููุชุธูุฉ
- [ ] ุฎุทุฉ ููุงุณุชุฌุงุจุฉ ููุญูุงุฏุซ

### ูุฑุงุฌุนุฉ ุดูุฑูุฉ:

- [ ] ูุญุต ุงูุณุฌูุงุช ูููุดุงุทุงุช ุงููุดุจููุฉ
- [ ] ูุฑุงุฌุนุฉ ุงูููุงุชูุญ ุงููุดุทุฉ
- [ ] ุญุฐู ุงูููุงุชูุญ ุบูุฑ ุงููุณุชุฎุฏูุฉ
- [ ] ุชุญุฏูุซ WordPress ู WooCommerce
- [ ] ูุญุต ุงูุฅุถุงูุงุช ููุซุบุฑุงุช
- [ ] ุงุฎุชุจุงุฑ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ
- [ ] ูุฑุงุฌุนุฉ ุตูุงุญูุงุช ุงููุณุชุฎุฏููู

---

## ๐ ููุงุฑุฏ ุฅุถุงููุฉ

### ูุตุงุฏุฑ ููุชุนูู:

- [OWASP REST Security Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/REST_Security_Cheat_Sheet.html)
- [WordPress Security White Paper](https://wordpress.org/about/security/)
- [WooCommerce Security Best Practices](https://woocommerce.com/document/security-best-practices/)

### ุฃุฏูุงุช ูุญุต ุงูุฃูุงู:

- [WPScan](https://wpscan.com/) - ูุญุต ุซุบุฑุงุช WordPress
- [Sucuri SiteCheck](https://sitecheck.sucuri.net/) - ูุญุต ุงููููุน
- [SSL Labs](https://www.ssllabs.com/ssltest/) - ูุญุต SSL

---

## ๐ ุงูุฅุจูุงุบ ุนู ุซุบุฑุงุช

ุฅุฐุง ุงูุชุดูุช ุซุบุฑุฉ ุฃูููุฉ:

๐ง **Email:** security@murjan.sa

**ูุฑุฌู ุชุถููู:**
- ูุตู ุชูุตููู ููุซุบุฑุฉ
- ุฎุทูุงุช ุฅุนุงุฏุฉ ุฅูุชุงุฌ ุงููุดููุฉ
- ุงูุชุฃุซูุฑ ุงููุญุชูู
- ุงูุชุฑุงุญุงุช ููุญู (ุฅู ููุฌุฏุช)

**ุณูููู ุจู:**
- โ ุงูุฑุฏ ุฎูุงู 24 ุณุงุนุฉ
- โ ุชูููู ุงูุซุบุฑุฉ
- โ ุชุทููุฑ ูุฅุตุฏุงุฑ ุชุญุฏูุซ
- โ ุฅุดุนุงุฑู ุจุงูุญู

---

**ุงูุฃูุงู ูุณุคูููุฉ ูุดุชุฑูุฉ. ๐**

ุดูุฑุงู ููุณุงุนุฏุชู ูู ุญูุงูุฉ ุงููุธุงู!

