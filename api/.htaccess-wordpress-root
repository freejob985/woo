# ================================
# 🔒 Murjan CORS Configuration
# ملف .htaccess لحل مشاكل CORS
# ================================
# 📝 ملاحظة: ضع هذا الملف في المجلد الجذر لـ WordPress
# Location: public_html/.htaccess أو www/.htaccess
# ================================

# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>
# END WordPress

# ================================
# 🌐 CORS Headers Configuration
# ================================
<IfModule mod_headers.c>
    # ✅ Handle preflight OPTIONS requests
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteRule ^(.*)$ $1 [R=200,L]
    
    # 🔐 Allow credentials (cookies, authorization)
    Header always set Access-Control-Allow-Credentials "true"
    
    # 📋 Allow all necessary HTTP methods
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, PATCH"
    
    # 📦 Allow all necessary headers
    Header always set Access-Control-Allow-Headers "Authorization, Content-Type, X-WP-Nonce, X-Requested-With, Accept, Origin, X-Api-Key"
    
    # 📊 Expose custom headers
    Header always set Access-Control-Expose-Headers "X-WP-Total, X-WP-TotalPages"
    
    # ⏱️ Cache preflight for 24 hours
    Header always set Access-Control-Max-Age "86400"
    
    # 🌍 Allow specific origins (PRODUCTION MODE - RECOMMENDED)
    # استخدم هذا الخيار للإنتاج - أكثر أماناً
    SetEnvIf Origin "^https://(woo-silk\.vercel\.app|woo-4pdx\.vercel\.app|dev\.murjan\.sa|murjan\.sa|www\.murjan\.sa)$" AccessControlAllowOrigin=$0
    SetEnvIf Origin "^http://(localhost:3000|localhost:5173|127\.0\.0\.1:3000|127\.0\.0\.1:5173)$" AccessControlAllowOrigin=$0
    Header always set Access-Control-Allow-Origin %{AccessControlAllowOrigin}e env=AccessControlAllowOrigin
    
    # OR use this for development (allow all origins - less secure)
    # للتطوير فقط - يسمح لجميع النطاقات
    # Header always set Access-Control-Allow-Origin "*"
</IfModule>

# ================================
# 🛡️ Security Headers
# ================================
<IfModule mod_headers.c>
    # Prevent clickjacking
    Header always set X-Frame-Options "SAMEORIGIN"
    
    # XSS Protection
    Header always set X-XSS-Protection "1; mode=block"
    
    # Prevent MIME sniffing
    Header always set X-Content-Type-Options "nosniff"
    
    # Referrer Policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# ================================
# 📝 Instructions | تعليمات الاستخدام
# ================================
# 1. ارفع هذا الملف إلى المجلد الجذر لـ WordPress
# 2. إذا كان لديك ملف .htaccess موجود، ادمج المحتوى معه
# 3. تأكد من أن mod_headers و mod_rewrite مفعّلة على السيرفر
# 4. إذا استمرت المشكلة، استخدم murjan-cors-fix.php كـ must-use plugin
# ================================

